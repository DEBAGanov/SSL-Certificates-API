# Правила разработки - SSL-Certificates-API

## Общие принципы

### Архитектурные принципы
- **SOLID** - применять принципы SOLID где это уместно
- **KISS** - Keep It Simple, Stupid - простые решения предпочтительнее сложных
- **DRY** - Don't Repeat Yourself - избегать дублирования кода и конфигурации
- **Security First** - безопасность является приоритетом во всех решениях

### Стиль кода
- Использовать современные практики и библиотеки
- Не использовать устаревшие методы и подходы
- Писать краткий, лаконичный и понятный код
- Комментировать сложную логику

## Документирование

### Обязательная документация
При внесении изменений обновлять:
1. `/docs/Tasktracker.md` - статус задач
2. `/docs/Diary.md` - важные решения и проблемы
3. `/docs/Project.md` - при изменении архитектуры

### Формат changelog записей
```markdown
## [YYYY-MM-DD] - Краткое описание
### Добавлено
- Описание новых функций

### Изменено
- Описание модификаций

### Исправлено
- Описание исправлений
```

### Заголовки файлов
При создании нового файла добавлять:
```
/**
 * @file: [имя файла]
 * @description: [краткое описание]
 * @dependencies: [связанные компоненты/файлы]
 * @created: [дата]
 */
```

## Docker и Caddy

### Docker Compose
- Использовать версию `3.8` или выше
- Всегда указывать `restart: unless-stopped`
- Настраивать logging с ротацией
- Использовать named volumes для persistence
- Не хардкодить секреты - использовать `.env`

### Caddyfile
- Группировать похожие домены
- Использовать глобальный блок для общих настроек
- Всегда указывать email для ACME
- Включать security headers для всех сайтов

### Безопасность
- TLS 1.2 минимум, предпочтительно TLS 1.3
- Включать HSTS headers
- Не логировать чувствительные данные
- Регулярно обновлять образы

## Именование

### Файлы и директории
- Файлы конфигурации: lowercase с дефисами (`docker-compose.yml`)
- Скрипты: lowercase с дефисами (`setup-server.sh`)
- Документация: PascalCase (`Project.md`, `Tasktracker.md`)

### Docker ресурсы
- Containers: lowercase с underscore или дефисами (`ssl-caddy`)
- Volumes: lowercase с underscore (`caddy_data`)
- Networks: lowercase с underscore (`ssl_network`)

### Переменные окружения
- UPPER_SNAKE_CASE (`ACME_EMAIL`, `BACKEND_HOST`)

## Процесс разработки

### Перед началом работы
1. Прочитать этот файл (`.cursorrules`)
2. Проверить текущий статус в `Tasktracker.md`
3. Ознакомиться с последними записями в `Diary.md`

### Во время работы
1. Обновлять статус задач в `Tasktracker.md`
2. Документировать важные решения в `Diary.md`
3. Тестировать изменения локально

### После завершения
1. Обновить документацию
2. Провести code review
3. Протестировать в staging (если доступен)

## Тестирование

### Caddy конфигурация
Перед деплоем проверять синтаксис:
```bash
docker run --rm -v $(pwd)/Caddyfile:/etc/caddy/Caddyfile caddy:2-alpine caddy validate --config /etc/caddy/Caddyfile
```

### SSL сертификаты
Проверять через:
- SSL Labs (https://www.ssllabs.com/ssltest/)
- openssl s_client

## Запрещено

- ❌ Хардкодить секреты и пароли
- ❌ Коммитить `.env` файлы с реальными данными
- ❌ Использовать устаревшие версии образов
- ❌ Отключать TLS или использовать самоподписанные сертификаты в production
- ❌ Игнорировать ошибки в логах
- ❌ Деплоить без тестирования

## Контакты и эскалация

При возникновении критических проблем:
1. Документировать проблему в `Diary.md`
2. Добавить задачу в `Tasktracker.md` с приоритетом "Критический"
3. Уведомить ответственного

---

*Версия правил: 1.0.0*
*Последнее обновление: 2025-12-05*

