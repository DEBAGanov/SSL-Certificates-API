# Дневник разработки - SSL-Certificates-API

## О документе

Данный документ содержит хронологические записи о процессе разработки проекта SSL-Certificates-API. Цель — обеспечить прозрачность и преемственность при работе разных разработчиков над проектом.

---

## 2025-12-05 - Инициализация проекта

### Наблюдения

1. **Выбор технологии:** Caddy Server выбран как основной инструмент для управления SSL сертификатами благодаря:
   - Встроенной поддержке автоматического HTTPS через Let's Encrypt
   - Простой конфигурации через Caddyfile
   - Поддержке HTTP/2 и HTTP/3 из коробки
   - Активному сообществу и регулярным обновлениям

2. **Архитектурное решение:** Принято решение использовать Docker Compose для оркестрации:
   - Простота развёртывания и масштабирования
   - Изоляция окружения
   - Лёгкость backup/restore через volumes

3. **Целевые домены:** Определены домены для настройки:
   - `dimbopizza.ru` - основной домен (IP: 2.59.42.195)
   - `*.volzhck.ru` - wildcard для всех поддоменов (IP: 178.253.43.111)
   - `antaliya.volzhck.ru`, `api.volzhck.ru`, `dimbo.volzhck.ru`, `dodopizza.volzhck.ru` (IP: 31.130.147.150)

4. **Требования к безопасности:** Определены базовые требования:
   - TLS 1.2+ (рекомендуется TLS 1.3)
   - HSTS headers
   - Автоматическое продление сертификатов

### Решения

1. **Структура проекта:** Создана базовая структура документации:
   ```
   docs/
   ├── Project.md      # Архитектура и описание
   ├── Tasktracker.md  # Отслеживание задач
   ├── Diary.md        # Этот файл
   └── qa.md           # Вопросы
   ```

2. **Версия Caddy:** Выбрана версия `2.10.2-alpine`:
   - Alpine образ для минимального размера
   - Стабильная версия с последними security patches

3. **Persistence:** Определены volumes для сохранения данных:
   - `/data` - SSL сертификаты и ключи
   - `/config` - конфигурация Caddy

4. **Logging:** Настроен JSON формат логов с ротацией:
   - max-size: 10MB
   - max-file: 3

### Проблемы

1. **[РЕШЕНА] Разные серверы:** Выбрана архитектура Single Entry Point - один Caddy сервер как единая точка входа для всех доменов.

2. **[РЕШЕНА] Backend endpoints:** Получены реальные IP адреса серверов:
   - dimbopizza.ru → 2.59.42.195
   - *.volzhck.ru → 178.253.43.111
   - antaliya/api/dimbo/dodopizza.volzhck.ru → 31.130.147.150

3. **[РЕШЕНА] DNS настройки:** DNS записи настроены и указывают на правильные IP адреса.

4. **[РЕШЕНА] Email для ACME:** Используется baganov.v@gmail.com

---

## 2025-12-05 - Обновление архитектуры с реальными данными

### Наблюдения

1. **Получены реальные IP адреса:** Заказчик предоставил полный список серверов и доменов
2. **Wildcard сертификаты:** Требуются для `*.volzhck.ru` - это усложняет настройку, так как нужен DNS challenge
3. **Простая конфигурация:** Требования к SLA низкие, можно использовать простую архитектуру без избыточности

### Решения

1. **Архитектура:** Single Entry Point с Caddy как reverse proxy
2. **Деплой:** Git-based деплой (push → автоматический деплой)
3. **Backup:** Только конфигурация Caddy

### Проблемы

1. **[РЕШЕНА] Wildcard сертификат:** DNS провайдер — Timeweb Cloud. К сожалению, для Timeweb нет готового DNS плагина для Caddy. Решение: используем HTTP challenge с отдельными сертификатами для каждого поддомена.

2. **[РЕШЕНА] Доступ к серверам:** CI/CD pipeline

---

## 2025-12-05 - Создание конфигурационных файлов

### Наблюдения

1. **DNS провайдер:** Timeweb Cloud используется для управления DNS записями volzhck.ru
2. **Wildcard ограничение:** Для Caddy нет готового DNS плагина для Timeweb Cloud API
3. **Альтернативное решение:** HTTP challenge работает для всех доменов без wildcard

### Решения

1. **docker-compose.yml:** Создан с Caddy 2.10.2-alpine, настроены volumes и healthcheck
2. **Caddyfile:** Созданы конфигурации для всех доменов:
   - dimbopizza.ru → 2.59.42.195
   - antaliya.volzhck.ru → 31.130.147.150
   - api.volzhck.ru → 31.130.147.150
   - dimbo.volzhck.ru → 31.130.147.150
   - dodopizza.volzhck.ru → 31.130.147.150
3. **Security headers:** Добавлены HSTS, X-Content-Type-Options, X-Frame-Options, X-XSS-Protection
4. **Сниппеты:** Созданы переиспользуемые блоки для headers, compression, logging

### Проблемы

1. **[ОТЛОЖЕНА] Wildcard сертификат:** Если в будущем потребуется wildcard для `*.volzhck.ru`, варианты:
   - Перенести DNS на Cloudflare (есть плагин caddy-dns/cloudflare)
   - Написать кастомный DNS провайдер для Timeweb API
   - Использовать certbot с Timeweb API отдельно

---

## Шаблон для новых записей

```markdown
## YYYY-MM-DD - Краткое описание

### Наблюдения

1. **Тема:** Описание наблюдения

### Решения

1. **Решение:** Описание принятого решения и его обоснование

### Проблемы

1. **[СТАТУС] Проблема:** Описание проблемы
   - Возможные решения
   - Требуемые действия
```

**Статусы проблем:**
- `[ОТКРЫТА]` - требует решения
- `[В РАБОТЕ]` - решается
- `[РЕШЕНА]` - решена
- `[ОТЛОЖЕНА]` - отложена на будущее

---

## Глоссарий

| Термин | Описание |
|--------|----------|
| ACME | Automatic Certificate Management Environment - протокол автоматического получения сертификатов |
| Let's Encrypt | Бесплатный Certificate Authority |
| Caddy | Веб-сервер с автоматическим HTTPS |
| Reverse Proxy | Прокси-сервер, перенаправляющий запросы на backend |
| TLS | Transport Layer Security - протокол шифрования |
| HSTS | HTTP Strict Transport Security - механизм принудительного HTTPS |

---

*Последнее обновление: 2025-12-05*

